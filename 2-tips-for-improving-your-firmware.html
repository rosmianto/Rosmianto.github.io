<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2 Tips for Improving Your Firmware - Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</title><meta name="description" content="Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script defer="defer" type="text/javascript" data-domain="rosmianto.com" src="https://view.rosmianto.com/js/script.outbound-links.tagged-events.js"></script><script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-gray.css"><link rel="stylesheet" href="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.css"><link rel="canonical" href="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><link rel="alternate" type="application/atom+xml" href="https://rosmianto.com/feed.xml"><link rel="alternate" type="application/json" href="https://rosmianto.com/feed.json"><meta property="og:title" content="2 Tips for Improving Your Firmware"><meta property="og:image" content="https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg"><meta property="og:image:width" content="4933"><meta property="og:image:height" content="3289"><meta property="og:site_name" content="Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì"><meta property="og:description" content="Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more&hellip;"><meta property="og:url" content="https://rosmianto.com/2-tips-for-improving-your-firmware.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://rosmianto.com/assets/css/style.css?v=7aa8cd9652c0014cd6c5dae831db723f"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://rosmianto.com/2-tips-for-improving-your-firmware.html"},"headline":"2 Tips for Improving Your Firmware","datePublished":"2024-03-25T10:12+07:00","dateModified":"2024-03-25T16:10+07:00","image":{"@type":"ImageObject","url":"https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg","height":3289,"width":4933},"description":"Josh is having a very bad day at work. He is a firmware engineer btw. ‚ÄúWtf? Boss wants 2 more&hellip;","author":{"@type":"Person","name":"Rosmianto A. Saputro","url":"https://rosmianto.com/authors/rosmianto-a-saputro/"},"publisher":{"@type":"Organization","name":"Rosmianto A. Saputro"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="lines"><div class="container lines lines--right"><header class="header"><a href="https://rosmianto.com/" class="logo">Captain Embedded üë®üèª‚Äç‚úàÔ∏è‚öì</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu">Menu</button><ul class="navbar__menu"><li><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" target="_self">Articles</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Products (NEW üî•)</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://fwguide.rosmianto.com" target="_blank">Firmware Development Guide</a></li></ul></li><li><a href="https://newsletter.rosmianto.com" target="_blank">Newsletter</a></li><li><a href="https://www.linkedin.com/in/rosmianto/" target="_blank">LinkedIn</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__inner post__header"><h1 class="post__title">2 Tips for Improving Your Firmware</h1><div class="post__meta"><div class="post__meta__left"><a href="https://rosmianto.com/authors/rosmianto-a-saputro/" class="invert post__author" rel="author" title="Rosmianto A. Saputro"><img src="https://rosmianto.com/media/website/Untitled-Diagram.jpg" loading="eager" height="1700" width="1700" alt="Rosmianto A. Saputro"> Rosmianto A. Saputro</a></div><div class="post__meta__right"><time datetime="2024-03-25T10:12" class="post__date">March 25, 2024</time><div class="post__updated">Updated on <time datetime="2024-03-25T10:12" class="post__date">March 25, 2024</time></div></div></div></header><figure class="post__featured-image"><div class="post__featured-image__inner is-img-loading"><img src="https://rosmianto.com/media/posts/19/c-m-iVfOFaEghqU-unsplash.jpg" srcset="https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-xs.jpg 384w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-sm.jpg 600w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-md.jpg 768w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-lg.jpg 1200w, https://rosmianto.com/media/posts/19/responsive/c-m-iVfOFaEghqU-unsplash-xl.jpg 1600w" sizes="(min-width: 37.5em) 1600px, 80vw" loading="eager" height="3289" width="4933" alt=""></div><figcaption>Photo by ubahnverleih on Unsplash</figcaption></figure><div class="post__inner"><div class="post__entry"><div><p>Josh is having a very bad day at work. He is a firmware engineer btw.<br><br>‚ÄúWtf? Boss wants 2 more features added to the firmware. Heck, I didn‚Äôt even fix my bug yesterday‚Äù He complained.<br><br>‚ÄúWhy? Aren‚Äôt those 2 features simple to implement?‚Äù I asked him.<br><br>‚ÄúEasier said than done! I need to touch maybe 20 files to do that. I‚Äôm afraid the code will break. It‚Äôs stressing me out!‚Äù He freaked out.<br><br>Here we can see the problem, well 3 problems:<br><br>‚Ä¢ Josh is struggling to add more features<br>‚Ä¢ Josh needs to touch tens of files to make small modifications<br>‚Ä¢ Josh is scared and not confident his work will be stable enough<br><br>Poor Josh. This thing shouldn‚Äôt be happening. Adding features shouldn‚Äôt be scary. In this article, I‚Äôm going to share 2 tips to kill Josh‚Äôs problems. But before we go through those tips, a few important notes:</p></div><div><ul><li><p>Improving your firmware means you need to improve your thinking. Because writing firmware is basically thinking in code</p></li><li><p>If you have too much hassle developing firmware, it means you need to either automate something or try another approach. Adding features should be straightforward (although not always easy, mind you)</p></li></ul></div><div><h2>Code Bloat ‚Üí Kill with Method Extraction</h2></div><div><p>Now, when Josh needed to add/change something, he had to modify his code in many locations. The code is similar (or even exactly the same), and he needed to use Ctrl+F to find everything.</p></div><div><p>This issue is called code duplication or code bloats. The solution is by extracting that similar code and create a function with appropriate parameters. For example, Josh has 2 similar code everywhere:</p></div><div><pre><code>// First code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 255; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><pre><code>// Second code block
uint8_t payload[255] = ....;

uint8_t checksum = 0;
for (int i = 0; i &lt; 254; i++) {
    // Long code here..
    checksum = ....;
}</code></pre></div><div><p>Did you notice the difference between 1st vs 2nd code block?</p></div><div><p>Second block has 254, first block instead has 255. When I asked Josh, he said that the second block for some reason needs to exclude the last byte to calculate the checksum (Wtf Josh, that is dangerous!)</p></div><div><p>Now, those two blocks can be extracted and written into a single function:</p></div><div><pre><code>uint8_t calculateChecksum(uint8_t* payload, bool excludeLastByte) {
    
    uint8_t checksum = 0;
    uint8_t payloadSize = excludeLastByte ? 254 : 255;
    // Long code here...
}</code></pre></div><div><p>From there, we can calculate checksum simply by calling <code>calculateChecksum(payload, true)</code>.</p></div><div><h2>Insecure of Code Stability ‚Üí Kill with Unit Test</h2></div><div><p>We have reduced code bloats into a single function. And this gives us one more benefit: we can test it individually. By using unit test, we can ensure that the code is consistent and outputs the correct value as we expect.</p></div><div><p>Unit testing is basically calling <code>calculateChecksum()</code> with known payload, we compare the actual checksum with the expected value. If they match, we‚Äôre fine.</p></div><div><p>Remember that unit testing doesn‚Äôt necessarily use any testing framework like Catch2, Google Test. As long as you can verify the output, you‚Äôre doing unit tests (However, manual testing is painful as the code grows, that‚Äôs why we use testing framework, to do <strong><i>automated</i></strong><strong>¬†</strong>unit testing)</p></div><div><h2>Summary</h2></div><div><p>Use those 2 tips, and you will be better at dealing with code redundancy and feel confident in your firmware. If you want to explore more about this concept, we have plenty: Test-Driven Development (TDD), Modular programming, Assertion, etc.</p></div><div><p>Those topics are actually interconnected, so take your time to learn them all.</p></div><p class="msg msg--info" data-slate-node="element">Whenever you're ready, there are 2 ways I can help you:<br><br>1. <a href="https://freelancer.rosmianto.com/">Becoming Embedded Freelancer Book</a>. Learn how to earn more money (even more than your main job) working on freelance projects using a proven path explained from an embedded engineer's point-of-view.<br><br>2. <a href="https://fwguide.rosmianto.com/">Firmware Development Workflow Guide</a>. Upgrade your workflow to achieve efficient development, consistent code quality, robust firmware, and skyrocketed your productivity as an embedded engineer.</p></div><footer class="post__footer"><div class="post__tag-share"><div class="post__tag"><h3 class="post__tag__title">Posted in</h3><ul class="post__tag__list"><li><a href="https://rosmianto.com/tags/embedded-tips/">Embedded Tips</a></li></ul></div><div class="post__share"></div></div></footer></div></article><div class="post__related"><h3 class="post__related__title">Related posts</h3><div class="l-grid l-grid--2"><article class="c-card"><div class="c-card__wrapper"><figure class="c-card__image is-img-loading"><img src="https://rosmianto.com/media/posts/32/titouan-colomb-pkCXegG4cdQ-unsplash.jpg" srcset="https://rosmianto.com/media/posts/32/responsive/titouan-colomb-pkCXegG4cdQ-unsplash-xs.jpg 384w, https://rosmianto.com/media/posts/32/responsive/titouan-colomb-pkCXegG4cdQ-unsplash-sm.jpg 600w, https://rosmianto.com/media/posts/32/responsive/titouan-colomb-pkCXegG4cdQ-unsplash-md.jpg 768w, https://rosmianto.com/media/posts/32/responsive/titouan-colomb-pkCXegG4cdQ-unsplash-lg.jpg 1200w" sizes="(min-width: 37.5em) 80vw, 50vw" loading="lazy" height="4032" width="3024" alt=""></figure><div class="c-card__content"><header><h2 class="c-card__title"><a href="https://rosmianto.com/day-3-imagine-this-story-in-your-head.html" class="invert">Day 3: imagine this story in your head</a></h2></header><footer class="c-card__meta"><a href="https://rosmianto.com/tags/embedded-freelancing/" class="c-card__tag">Embedded Freelancing</a></footer></div></div></article><article class="c-card"><div class="c-card__wrapper"><figure class="c-card__image is-img-loading"><img src="https://rosmianto.com/media/posts/31/morgan-housel-PcDGGex9-jA-unsplash.jpg" srcset="https://rosmianto.com/media/posts/31/responsive/morgan-housel-PcDGGex9-jA-unsplash-xs.jpg 384w, https://rosmianto.com/media/posts/31/responsive/morgan-housel-PcDGGex9-jA-unsplash-sm.jpg 600w, https://rosmianto.com/media/posts/31/responsive/morgan-housel-PcDGGex9-jA-unsplash-md.jpg 768w, https://rosmianto.com/media/posts/31/responsive/morgan-housel-PcDGGex9-jA-unsplash-lg.jpg 1200w" sizes="(min-width: 37.5em) 80vw, 50vw" loading="lazy" height="2800" width="4400" alt=""></figure><div class="c-card__content"><header><h2 class="c-card__title"><a href="https://rosmianto.com/day-2-two-ways-to-boost-your-income-as-an-embedded-engineer.html" class="invert">Day 2: Two ways to boost your income as an embedded engineer</a></h2></header><footer class="c-card__meta"><a href="https://rosmianto.com/tags/embedded-freelancing/" class="c-card__tag">Embedded Freelancing</a></footer></div></div></article></div></div></main><footer class="footer"><div class="footer__left"><div class="footer__copy">Powered by Publii</div></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://rosmianto.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = { mobileMenuMode: 'sidebar', animationSpeed: 300, submenuWidth: 'auto', doubleClickTime: 500, mobileMenuExpandableSubmenus: true, relatedContainerForOverlayMenuSelector: '.navbar', };</script><script defer="defer" src="https://rosmianto.com/assets/js/scripts.min.js?v=6450cfc483efd7e58ed8ad5b64050d3e"></script><script>function publiiDetectLoadedImages () {
         var images = document.querySelectorAll('img[loading]:not(.is-loaded)');
         for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
               images[i].classList.add('is-loaded');
               images[i].parentNode.classList.remove('is-img-loading');
            } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
                  this.parentNode.classList.remove('is-img-loading');
               }, false);
            }
         }
      }
      publiiDetectLoadedImages();</script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-line-numbers.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-copy-to-clipboard.min.js"></script><script defer="defer" src="https://rosmianto.com/media/plugins/syntaxHighlighter/prism-inline-color.min.js"></script></body></html>